\section{liblzma/api/lzma/block.h File Reference}
\label{block_8h}\index{liblzma/api/lzma/block.\-h@{liblzma/api/lzma/block.\-h}}


.xz Block handling  


\subsection*{Data Structures}
\begin{DoxyCompactItemize}
\item 
struct {\bf lzma\-\_\-block}
\begin{DoxyCompactList}\small\item\em Options for the Block and Block Header encoders and decoders. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define {\bfseries L\-Z\-M\-A\-\_\-\-B\-L\-O\-C\-K\-\_\-\-H\-E\-A\-D\-E\-R\-\_\-\-S\-I\-Z\-E\-\_\-\-M\-I\-N}~8\label{block_8h_a9263c5b314592e658772e5eb83ffdd78}

\item 
\#define {\bfseries L\-Z\-M\-A\-\_\-\-B\-L\-O\-C\-K\-\_\-\-H\-E\-A\-D\-E\-R\-\_\-\-S\-I\-Z\-E\-\_\-\-M\-A\-X}~1024\label{block_8h_af7a39189d0721c55313a401b63811e49}

\item 
\#define {\bf lzma\-\_\-block\-\_\-header\-\_\-size\-\_\-decode}(b)~(((uint32\-\_\-t)(b) + 1) $\ast$ 4)
\begin{DoxyCompactList}\small\item\em Decode the Block Header Size field. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
{\bf lzma\-\_\-ret} {\bf lzma\-\_\-block\-\_\-header\-\_\-size} ({\bf lzma\-\_\-block} $\ast$block) lzma\-\_\-nothrow lzma\-\_\-attr\-\_\-warn\-\_\-unused\-\_\-result
\begin{DoxyCompactList}\small\item\em Calculate Block Header Size. \end{DoxyCompactList}\item 
{\bf lzma\-\_\-ret} {\bf lzma\-\_\-block\-\_\-header\-\_\-encode} (const {\bf lzma\-\_\-block} $\ast$block, uint8\-\_\-t $\ast$out) lzma\-\_\-nothrow lzma\-\_\-attr\-\_\-warn\-\_\-unused\-\_\-result
\begin{DoxyCompactList}\small\item\em Encode Block Header. \end{DoxyCompactList}\item 
{\bf lzma\-\_\-ret} {\bf lzma\-\_\-block\-\_\-header\-\_\-decode} ({\bf lzma\-\_\-block} $\ast$block, {\bf lzma\-\_\-allocator} $\ast$allocator, const uint8\-\_\-t $\ast$in) lzma\-\_\-nothrow lzma\-\_\-attr\-\_\-warn\-\_\-unused\-\_\-result
\begin{DoxyCompactList}\small\item\em Decode Block Header. \end{DoxyCompactList}\item 
{\bf lzma\-\_\-ret} {\bf lzma\-\_\-block\-\_\-compressed\-\_\-size} ({\bf lzma\-\_\-block} $\ast$block, {\bf lzma\-\_\-vli} unpadded\-\_\-size) lzma\-\_\-nothrow lzma\-\_\-attr\-\_\-warn\-\_\-unused\-\_\-result
\begin{DoxyCompactList}\small\item\em Validate and set Compressed Size according to Unpadded Size. \end{DoxyCompactList}\item 
{\bf lzma\-\_\-vli} {\bf lzma\-\_\-block\-\_\-unpadded\-\_\-size} (const {\bf lzma\-\_\-block} $\ast$block) lzma\-\_\-nothrow lzma\-\_\-attr\-\_\-pure
\begin{DoxyCompactList}\small\item\em Calculate Unpadded Size. \end{DoxyCompactList}\item 
{\bf lzma\-\_\-vli} {\bf lzma\-\_\-block\-\_\-total\-\_\-size} (const {\bf lzma\-\_\-block} $\ast$block) lzma\-\_\-nothrow lzma\-\_\-attr\-\_\-pure
\begin{DoxyCompactList}\small\item\em Calculate the total encoded size of a Block. \end{DoxyCompactList}\item 
{\bf lzma\-\_\-ret} {\bf lzma\-\_\-block\-\_\-encoder} ({\bf lzma\-\_\-stream} $\ast${\bf strm}, {\bf lzma\-\_\-block} $\ast$block) lzma\-\_\-nothrow lzma\-\_\-attr\-\_\-warn\-\_\-unused\-\_\-result
\begin{DoxyCompactList}\small\item\em Initialize .xz Block encoder. \end{DoxyCompactList}\item 
{\bf lzma\-\_\-ret} {\bf lzma\-\_\-block\-\_\-decoder} ({\bf lzma\-\_\-stream} $\ast${\bf strm}, {\bf lzma\-\_\-block} $\ast$block) lzma\-\_\-nothrow lzma\-\_\-attr\-\_\-warn\-\_\-unused\-\_\-result
\begin{DoxyCompactList}\small\item\em Initialize .xz Block decoder. \end{DoxyCompactList}\item 
size\-\_\-t {\bf lzma\-\_\-block\-\_\-buffer\-\_\-bound} (size\-\_\-t uncompressed\-\_\-size) lzma\-\_\-nothrow
\begin{DoxyCompactList}\small\item\em Calculate maximum output size for single-\/call Block encoding. \end{DoxyCompactList}\item 
{\bf lzma\-\_\-ret} {\bf lzma\-\_\-block\-\_\-buffer\-\_\-encode} ({\bf lzma\-\_\-block} $\ast$block, {\bf lzma\-\_\-allocator} $\ast$allocator, const uint8\-\_\-t $\ast$in, size\-\_\-t in\-\_\-size, uint8\-\_\-t $\ast$out, size\-\_\-t $\ast$out\-\_\-pos, size\-\_\-t out\-\_\-size) lzma\-\_\-nothrow lzma\-\_\-attr\-\_\-warn\-\_\-unused\-\_\-result
\begin{DoxyCompactList}\small\item\em Single-\/call .xz Block encoder. \end{DoxyCompactList}\item 
{\bf lzma\-\_\-ret} {\bf lzma\-\_\-block\-\_\-buffer\-\_\-decode} ({\bf lzma\-\_\-block} $\ast$block, {\bf lzma\-\_\-allocator} $\ast$allocator, const uint8\-\_\-t $\ast$in, size\-\_\-t $\ast$in\-\_\-pos, size\-\_\-t in\-\_\-size, uint8\-\_\-t $\ast$out, size\-\_\-t $\ast$out\-\_\-pos, size\-\_\-t out\-\_\-size) lzma\-\_\-nothrow
\begin{DoxyCompactList}\small\item\em Single-\/call .xz Block decoder. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
.xz Block handling 

\subsection{Macro Definition Documentation}
\index{block.\-h@{block.\-h}!lzma\-\_\-block\-\_\-header\-\_\-size\-\_\-decode@{lzma\-\_\-block\-\_\-header\-\_\-size\-\_\-decode}}
\index{lzma\-\_\-block\-\_\-header\-\_\-size\-\_\-decode@{lzma\-\_\-block\-\_\-header\-\_\-size\-\_\-decode}!block.h@{block.\-h}}
\subsubsection[{lzma\-\_\-block\-\_\-header\-\_\-size\-\_\-decode}]{\setlength{\rightskip}{0pt plus 5cm}\#define lzma\-\_\-block\-\_\-header\-\_\-size\-\_\-decode(
\begin{DoxyParamCaption}
\item[{}]{b}
\end{DoxyParamCaption}
)~(((uint32\-\_\-t)(b) + 1) $\ast$ 4)}\label{block_8h_ac025c940683a70f4c7f956bad814fd5f}


Decode the Block Header Size field. 

To decode Block Header using \doxyref{lzma\-\_\-block\-\_\-header\-\_\-decode()}{p.}{block_8h_a71ddd0bec506092018e407ed6f027f53}, the size of the Block Header has to be known and stored into \doxyref{lzma\-\_\-block.\-header\-\_\-size}{p.}{structlzma__block_a6689c4f7524b2c05772a2d6151138610}. The size can be calculated from the first byte of a Block using this macro. Note that if the first byte is 0x00, it indicates beginning of Index; use this macro only when the byte is not 0x00.

There is no encoding macro, because Block Header encoder is enough for that. 

Referenced by lzma\-\_\-block\-\_\-header\-\_\-decode(), and parse\-\_\-block\-\_\-header().



\subsection{Function Documentation}
\index{block.\-h@{block.\-h}!lzma\-\_\-block\-\_\-header\-\_\-size@{lzma\-\_\-block\-\_\-header\-\_\-size}}
\index{lzma\-\_\-block\-\_\-header\-\_\-size@{lzma\-\_\-block\-\_\-header\-\_\-size}!block.h@{block.\-h}}
\subsubsection[{lzma\-\_\-block\-\_\-header\-\_\-size}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lzma\-\_\-ret} lzma\-\_\-block\-\_\-header\-\_\-size (
\begin{DoxyParamCaption}
\item[{{\bf lzma\-\_\-block} $\ast$}]{block}
\end{DoxyParamCaption}
)}\label{block_8h_ae9b47abc872d0b02c2da9d3fa5a7dacd}


Calculate Block Header Size. 

Calculate the minimum size needed for the Block Header field using the settings specified in the \doxyref{lzma\-\_\-block}{p.}{structlzma__block} structure. Note that it is O\-K to increase the calculated header\-\_\-size value as long as it is a multiple of four and doesn't exceed L\-Z\-M\-A\-\_\-\-B\-L\-O\-C\-K\-\_\-\-H\-E\-A\-D\-E\-R\-\_\-\-S\-I\-Z\-E\-\_\-\-M\-A\-X. Increasing header\-\_\-size just means that \doxyref{lzma\-\_\-block\-\_\-header\-\_\-encode()}{p.}{block_8h_a0eedbd6331d5708ea963260e6f2a92d0} will add Header Padding.

\begin{DoxyReturn}{Returns}
-\/ L\-Z\-M\-A\-\_\-\-O\-K\-: Size calculated successfully and stored to block-\/$>$header\-\_\-size.
\begin{DoxyItemize}
\item L\-Z\-M\-A\-\_\-\-O\-P\-T\-I\-O\-N\-S\-\_\-\-E\-R\-R\-O\-R\-: Unsupported version, filters or filter options.
\item L\-Z\-M\-A\-\_\-\-P\-R\-O\-G\-\_\-\-E\-R\-R\-O\-R\-: Invalid values like compressed\-\_\-size == 0.
\end{DoxyItemize}
\end{DoxyReturn}
\begin{DoxyNote}{Note}
This doesn't check that all the options are valid i.\-e. this may return L\-Z\-M\-A\-\_\-\-O\-K even if \doxyref{lzma\-\_\-block\-\_\-header\-\_\-encode()}{p.}{block_8h_a0eedbd6331d5708ea963260e6f2a92d0} or \doxyref{lzma\-\_\-block\-\_\-encoder()}{p.}{block_8h_a2218a49025a0b44f9a6f9d6d24359359} would fail. If you want to validate the filter chain, consider using lzma\-\_\-memlimit\-\_\-encoder() which as a side-\/effect validates the filter chain. 
\end{DoxyNote}


References lzma\-\_\-filter\-\_\-flags\-\_\-size(), L\-Z\-M\-A\-\_\-\-F\-I\-L\-T\-E\-R\-S\-\_\-\-M\-A\-X, L\-Z\-M\-A\-\_\-\-O\-K, L\-Z\-M\-A\-\_\-\-O\-P\-T\-I\-O\-N\-S\-\_\-\-E\-R\-R\-O\-R, L\-Z\-M\-A\-\_\-\-P\-R\-O\-G\-\_\-\-E\-R\-R\-O\-R, lzma\-\_\-vli\-\_\-size(), L\-Z\-M\-A\-\_\-\-V\-L\-I\-\_\-\-U\-N\-K\-N\-O\-W\-N, and return\-\_\-if\-\_\-error.

\index{block.\-h@{block.\-h}!lzma\-\_\-block\-\_\-header\-\_\-encode@{lzma\-\_\-block\-\_\-header\-\_\-encode}}
\index{lzma\-\_\-block\-\_\-header\-\_\-encode@{lzma\-\_\-block\-\_\-header\-\_\-encode}!block.h@{block.\-h}}
\subsubsection[{lzma\-\_\-block\-\_\-header\-\_\-encode}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lzma\-\_\-ret} lzma\-\_\-block\-\_\-header\-\_\-encode (
\begin{DoxyParamCaption}
\item[{const {\bf lzma\-\_\-block} $\ast$}]{block, }
\item[{uint8\-\_\-t $\ast$}]{out}
\end{DoxyParamCaption}
)}\label{block_8h_a0eedbd6331d5708ea963260e6f2a92d0}


Encode Block Header. 

The caller must have calculated the size of the Block Header already with \doxyref{lzma\-\_\-block\-\_\-header\-\_\-size()}{p.}{block_8h_ae9b47abc872d0b02c2da9d3fa5a7dacd}. If a value larger than the one calculated by \doxyref{lzma\-\_\-block\-\_\-header\-\_\-size()}{p.}{block_8h_ae9b47abc872d0b02c2da9d3fa5a7dacd} is used, the Block Header will be padded to the specified size.


\begin{DoxyParams}{Parameters}
{\em out} & Beginning of the output buffer. This must be at least block-\/$>$header\-\_\-size bytes. \\
\hline
{\em block} & Block options to be encoded.\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
-\/ L\-Z\-M\-A\-\_\-\-O\-K\-: Encoding was successful. block-\/$>$header\-\_\-size bytes were written to output buffer.
\begin{DoxyItemize}
\item L\-Z\-M\-A\-\_\-\-O\-P\-T\-I\-O\-N\-S\-\_\-\-E\-R\-R\-O\-R\-: Invalid or unsupported options.
\item L\-Z\-M\-A\-\_\-\-P\-R\-O\-G\-\_\-\-E\-R\-R\-O\-R\-: Invalid arguments, for example block-\/$>$header\-\_\-size is invalid or block-\/$>$filters is N\-U\-L\-L. 
\end{DoxyItemize}
\end{DoxyReturn}


References lzma\-\_\-block\-\_\-unpadded\-\_\-size(), lzma\-\_\-crc32(), lzma\-\_\-filter\-\_\-flags\-\_\-encode(), L\-Z\-M\-A\-\_\-\-F\-I\-L\-T\-E\-R\-S\-\_\-\-M\-A\-X, L\-Z\-M\-A\-\_\-\-O\-K, L\-Z\-M\-A\-\_\-\-P\-R\-O\-G\-\_\-\-E\-R\-R\-O\-R, lzma\-\_\-vli\-\_\-encode(), lzma\-\_\-vli\-\_\-is\-\_\-valid, L\-Z\-M\-A\-\_\-\-V\-L\-I\-\_\-\-U\-N\-K\-N\-O\-W\-N, and return\-\_\-if\-\_\-error.

\index{block.\-h@{block.\-h}!lzma\-\_\-block\-\_\-header\-\_\-decode@{lzma\-\_\-block\-\_\-header\-\_\-decode}}
\index{lzma\-\_\-block\-\_\-header\-\_\-decode@{lzma\-\_\-block\-\_\-header\-\_\-decode}!block.h@{block.\-h}}
\subsubsection[{lzma\-\_\-block\-\_\-header\-\_\-decode}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lzma\-\_\-ret} lzma\-\_\-block\-\_\-header\-\_\-decode (
\begin{DoxyParamCaption}
\item[{{\bf lzma\-\_\-block} $\ast$}]{block, }
\item[{{\bf lzma\-\_\-allocator} $\ast$}]{allocator, }
\item[{const uint8\-\_\-t $\ast$}]{in}
\end{DoxyParamCaption}
)}\label{block_8h_a71ddd0bec506092018e407ed6f027f53}


Decode Block Header. 

block-\/$>$version should be set to the highest value supported by the application; currently the only possible version is zero. This function will set version to the lowest value that still supports all the features required by the Block Header.

The size of the Block Header must have already been decoded with \doxyref{lzma\-\_\-block\-\_\-header\-\_\-size\-\_\-decode()}{p.}{block_8h_ac025c940683a70f4c7f956bad814fd5f} macro and stored to block-\/$>$header\-\_\-size.

block-\/$>$filters must have been allocated, but they don't need to be initialized (possible existing filter options are not freed).


\begin{DoxyParams}{Parameters}
{\em block} & Destination for Block options. \\
\hline
{\em allocator} & \doxyref{lzma\-\_\-allocator}{p.}{structlzma__allocator} for custom allocator functions. Set to N\-U\-L\-L to use malloc() (and also free() if an error occurs). \\
\hline
{\em in} & Beginning of the input buffer. This must be at least block-\/$>$header\-\_\-size bytes.\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
-\/ L\-Z\-M\-A\-\_\-\-O\-K\-: Decoding was successful. block-\/$>$header\-\_\-size bytes were read from the input buffer.
\begin{DoxyItemize}
\item L\-Z\-M\-A\-\_\-\-O\-P\-T\-I\-O\-N\-S\-\_\-\-E\-R\-R\-O\-R\-: The Block Header specifies some unsupported options such as unsupported filters. This can happen also if block-\/$>$version was set to a too low value compared to what would be required to properly represent the information stored in the Block Header.
\item L\-Z\-M\-A\-\_\-\-D\-A\-T\-A\-\_\-\-E\-R\-R\-O\-R\-: Block Header is corrupt, for example, the C\-R\-C32 doesn't match.
\item L\-Z\-M\-A\-\_\-\-P\-R\-O\-G\-\_\-\-E\-R\-R\-O\-R\-: Invalid arguments, for example block-\/$>$header\-\_\-size is invalid or block-\/$>$filters is N\-U\-L\-L. 
\end{DoxyItemize}
\end{DoxyReturn}


References lzma\-\_\-block\-\_\-header\-\_\-size\-\_\-decode, lzma\-\_\-block\-\_\-unpadded\-\_\-size(), L\-Z\-M\-A\-\_\-\-C\-H\-E\-C\-K\-\_\-\-I\-D\-\_\-\-M\-A\-X, lzma\-\_\-crc32(), L\-Z\-M\-A\-\_\-\-D\-A\-T\-A\-\_\-\-E\-R\-R\-O\-R, lzma\-\_\-filter\-\_\-flags\-\_\-decode(), L\-Z\-M\-A\-\_\-\-F\-I\-L\-T\-E\-R\-S\-\_\-\-M\-A\-X, L\-Z\-M\-A\-\_\-\-O\-K, L\-Z\-M\-A\-\_\-\-O\-P\-T\-I\-O\-N\-S\-\_\-\-E\-R\-R\-O\-R, L\-Z\-M\-A\-\_\-\-P\-R\-O\-G\-\_\-\-E\-R\-R\-O\-R, lzma\-\_\-vli\-\_\-decode(), L\-Z\-M\-A\-\_\-\-V\-L\-I\-\_\-\-U\-N\-K\-N\-O\-W\-N, and return\-\_\-if\-\_\-error.



Referenced by parse\-\_\-block\-\_\-header().

\index{block.\-h@{block.\-h}!lzma\-\_\-block\-\_\-compressed\-\_\-size@{lzma\-\_\-block\-\_\-compressed\-\_\-size}}
\index{lzma\-\_\-block\-\_\-compressed\-\_\-size@{lzma\-\_\-block\-\_\-compressed\-\_\-size}!block.h@{block.\-h}}
\subsubsection[{lzma\-\_\-block\-\_\-compressed\-\_\-size}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lzma\-\_\-ret} lzma\-\_\-block\-\_\-compressed\-\_\-size (
\begin{DoxyParamCaption}
\item[{{\bf lzma\-\_\-block} $\ast$}]{block, }
\item[{{\bf lzma\-\_\-vli}}]{unpadded\-\_\-size}
\end{DoxyParamCaption}
)}\label{block_8h_a6c3e102d76db06a07126a569abc6e2bc}


Validate and set Compressed Size according to Unpadded Size. 

Block Header stores Compressed Size, but Index has Unpadded Size. If the application has already parsed the Index and is now decoding Blocks, it can calculate Compressed Size from Unpadded Size. This function does exactly that with error checking\-:


\begin{DoxyItemize}
\item Compressed Size calculated from Unpadded Size must be positive integer, that is, Unpadded Size must be big enough that after Block Header and Check fields there's still at least one byte for Compressed Size.
\end{DoxyItemize}


\begin{DoxyItemize}
\item If Compressed Size was present in Block Header, the new value calculated from Unpadded Size is compared against the value from Block Header.
\end{DoxyItemize}

\begin{DoxyNote}{Note}
This function must be called {\itshape after} decoding the Block Header field so that it can properly validate Compressed Size if it was present in Block Header.
\end{DoxyNote}
\begin{DoxyReturn}{Returns}
-\/ L\-Z\-M\-A\-\_\-\-O\-K\-: block-\/$>$compressed\-\_\-size was set successfully.
\begin{DoxyItemize}
\item L\-Z\-M\-A\-\_\-\-D\-A\-T\-A\-\_\-\-E\-R\-R\-O\-R\-: unpadded\-\_\-size is too small compared to block-\/$>$header\-\_\-size and lzma\-\_\-check\-\_\-size(block-\/$>$check).
\item L\-Z\-M\-A\-\_\-\-P\-R\-O\-G\-\_\-\-E\-R\-R\-O\-R\-: Some values are invalid. For example, block-\/$>$header\-\_\-size must be a multiple of four and between 8 and 1024 inclusive. 
\end{DoxyItemize}
\end{DoxyReturn}


References lzma\-\_\-block\-\_\-unpadded\-\_\-size(), lzma\-\_\-check\-\_\-size(), L\-Z\-M\-A\-\_\-\-D\-A\-T\-A\-\_\-\-E\-R\-R\-O\-R, L\-Z\-M\-A\-\_\-\-O\-K, L\-Z\-M\-A\-\_\-\-P\-R\-O\-G\-\_\-\-E\-R\-R\-O\-R, and L\-Z\-M\-A\-\_\-\-V\-L\-I\-\_\-\-U\-N\-K\-N\-O\-W\-N.



Referenced by parse\-\_\-block\-\_\-header().

\index{block.\-h@{block.\-h}!lzma\-\_\-block\-\_\-unpadded\-\_\-size@{lzma\-\_\-block\-\_\-unpadded\-\_\-size}}
\index{lzma\-\_\-block\-\_\-unpadded\-\_\-size@{lzma\-\_\-block\-\_\-unpadded\-\_\-size}!block.h@{block.\-h}}
\subsubsection[{lzma\-\_\-block\-\_\-unpadded\-\_\-size}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lzma\-\_\-vli} lzma\-\_\-block\-\_\-unpadded\-\_\-size (
\begin{DoxyParamCaption}
\item[{const {\bf lzma\-\_\-block} $\ast$}]{block}
\end{DoxyParamCaption}
)}\label{block_8h_a412d5605280fa29befae1b89e344bf30}


Calculate Unpadded Size. 

The Index field stores Unpadded Size and Uncompressed Size. The latter can be taken directly from the \doxyref{lzma\-\_\-block}{p.}{structlzma__block} structure after coding a Block, but Unpadded Size needs to be calculated from Block Header Size, Compressed Size, and size of the Check field. This is where this function is needed.

\begin{DoxyReturn}{Returns}
Unpadded Size on success, or zero on error. 
\end{DoxyReturn}


References L\-Z\-M\-A\-\_\-\-C\-H\-E\-C\-K\-\_\-\-I\-D\-\_\-\-M\-A\-X, lzma\-\_\-check\-\_\-size(), lzma\-\_\-vli\-\_\-is\-\_\-valid, and L\-Z\-M\-A\-\_\-\-V\-L\-I\-\_\-\-U\-N\-K\-N\-O\-W\-N.



Referenced by lzma\-\_\-block\-\_\-compressed\-\_\-size(), lzma\-\_\-block\-\_\-header\-\_\-decode(), lzma\-\_\-block\-\_\-header\-\_\-encode(), lzma\-\_\-block\-\_\-total\-\_\-size(), and lzma\-\_\-stream\-\_\-buffer\-\_\-encode().

\index{block.\-h@{block.\-h}!lzma\-\_\-block\-\_\-total\-\_\-size@{lzma\-\_\-block\-\_\-total\-\_\-size}}
\index{lzma\-\_\-block\-\_\-total\-\_\-size@{lzma\-\_\-block\-\_\-total\-\_\-size}!block.h@{block.\-h}}
\subsubsection[{lzma\-\_\-block\-\_\-total\-\_\-size}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lzma\-\_\-vli} lzma\-\_\-block\-\_\-total\-\_\-size (
\begin{DoxyParamCaption}
\item[{const {\bf lzma\-\_\-block} $\ast$}]{block}
\end{DoxyParamCaption}
)}\label{block_8h_a694424f9dfdd5151e01debac1c501fa9}


Calculate the total encoded size of a Block. 

This is equivalent to \doxyref{lzma\-\_\-block\-\_\-unpadded\-\_\-size()}{p.}{block_8h_a412d5605280fa29befae1b89e344bf30} except that the returned value includes the size of the Block Padding field.

\begin{DoxyReturn}{Returns}
On success, total encoded size of the Block. On error, zero is returned. 
\end{DoxyReturn}


References lzma\-\_\-block\-\_\-unpadded\-\_\-size(), and L\-Z\-M\-A\-\_\-\-V\-L\-I\-\_\-\-U\-N\-K\-N\-O\-W\-N.

\index{block.\-h@{block.\-h}!lzma\-\_\-block\-\_\-encoder@{lzma\-\_\-block\-\_\-encoder}}
\index{lzma\-\_\-block\-\_\-encoder@{lzma\-\_\-block\-\_\-encoder}!block.h@{block.\-h}}
\subsubsection[{lzma\-\_\-block\-\_\-encoder}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lzma\-\_\-ret} lzma\-\_\-block\-\_\-encoder (
\begin{DoxyParamCaption}
\item[{{\bf lzma\-\_\-stream} $\ast$}]{strm, }
\item[{{\bf lzma\-\_\-block} $\ast$}]{block}
\end{DoxyParamCaption}
)}\label{block_8h_a2218a49025a0b44f9a6f9d6d24359359}


Initialize .xz Block encoder. 

Valid actions for \doxyref{lzma\-\_\-code()}{p.}{base_8h_a28cc09bc422d5ba1e0187c9f2af5d957} are L\-Z\-M\-A\-\_\-\-R\-U\-N, L\-Z\-M\-A\-\_\-\-S\-Y\-N\-C\-\_\-\-F\-L\-U\-S\-H (only if the filter chain supports it), and L\-Z\-M\-A\-\_\-\-F\-I\-N\-I\-S\-H.

\begin{DoxyReturn}{Returns}
-\/ L\-Z\-M\-A\-\_\-\-O\-K\-: All good, continue with \doxyref{lzma\-\_\-code()}{p.}{base_8h_a28cc09bc422d5ba1e0187c9f2af5d957}.
\begin{DoxyItemize}
\item L\-Z\-M\-A\-\_\-\-M\-E\-M\-\_\-\-E\-R\-R\-O\-R
\item L\-Z\-M\-A\-\_\-\-O\-P\-T\-I\-O\-N\-S\-\_\-\-E\-R\-R\-O\-R
\item L\-Z\-M\-A\-\_\-\-U\-N\-S\-U\-P\-P\-O\-R\-T\-E\-D\-\_\-\-C\-H\-E\-C\-K\-: block-\/$>$check specifies a Check I\-D that is not supported by this buid of liblzma. Initializing the encoder failed.
\item L\-Z\-M\-A\-\_\-\-P\-R\-O\-G\-\_\-\-E\-R\-R\-O\-R 
\end{DoxyItemize}
\end{DoxyReturn}


References L\-Z\-M\-A\-\_\-\-F\-I\-N\-I\-S\-H, lzma\-\_\-next\-\_\-strm\-\_\-init, L\-Z\-M\-A\-\_\-\-O\-K, and L\-Z\-M\-A\-\_\-\-R\-U\-N.

\index{block.\-h@{block.\-h}!lzma\-\_\-block\-\_\-decoder@{lzma\-\_\-block\-\_\-decoder}}
\index{lzma\-\_\-block\-\_\-decoder@{lzma\-\_\-block\-\_\-decoder}!block.h@{block.\-h}}
\subsubsection[{lzma\-\_\-block\-\_\-decoder}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lzma\-\_\-ret} lzma\-\_\-block\-\_\-decoder (
\begin{DoxyParamCaption}
\item[{{\bf lzma\-\_\-stream} $\ast$}]{strm, }
\item[{{\bf lzma\-\_\-block} $\ast$}]{block}
\end{DoxyParamCaption}
)}\label{block_8h_aa92c73b2a228efe921fa2376aa7adc92}


Initialize .xz Block decoder. 

Valid actions for \doxyref{lzma\-\_\-code()}{p.}{base_8h_a28cc09bc422d5ba1e0187c9f2af5d957} are L\-Z\-M\-A\-\_\-\-R\-U\-N and L\-Z\-M\-A\-\_\-\-F\-I\-N\-I\-S\-H. Using L\-Z\-M\-A\-\_\-\-F\-I\-N\-I\-S\-H is not required. It is supported only for convenience.

\begin{DoxyReturn}{Returns}
-\/ L\-Z\-M\-A\-\_\-\-O\-K\-: All good, continue with \doxyref{lzma\-\_\-code()}{p.}{base_8h_a28cc09bc422d5ba1e0187c9f2af5d957}.
\begin{DoxyItemize}
\item L\-Z\-M\-A\-\_\-\-U\-N\-S\-U\-P\-P\-O\-R\-T\-E\-D\-\_\-\-C\-H\-E\-C\-K\-: Initialization was successful, but the given Check I\-D is not supported, thus Check will be ignored.
\item L\-Z\-M\-A\-\_\-\-P\-R\-O\-G\-\_\-\-E\-R\-R\-O\-R
\item L\-Z\-M\-A\-\_\-\-M\-E\-M\-\_\-\-E\-R\-R\-O\-R 
\end{DoxyItemize}
\end{DoxyReturn}


References L\-Z\-M\-A\-\_\-\-F\-I\-N\-I\-S\-H, lzma\-\_\-next\-\_\-strm\-\_\-init, L\-Z\-M\-A\-\_\-\-O\-K, and L\-Z\-M\-A\-\_\-\-R\-U\-N.

\index{block.\-h@{block.\-h}!lzma\-\_\-block\-\_\-buffer\-\_\-bound@{lzma\-\_\-block\-\_\-buffer\-\_\-bound}}
\index{lzma\-\_\-block\-\_\-buffer\-\_\-bound@{lzma\-\_\-block\-\_\-buffer\-\_\-bound}!block.h@{block.\-h}}
\subsubsection[{lzma\-\_\-block\-\_\-buffer\-\_\-bound}]{\setlength{\rightskip}{0pt plus 5cm}size\-\_\-t lzma\-\_\-block\-\_\-buffer\-\_\-bound (
\begin{DoxyParamCaption}
\item[{size\-\_\-t}]{uncompressed\-\_\-size}
\end{DoxyParamCaption}
)}\label{block_8h_a58ff73e2572b529f48cc590bfffe5b4f}


Calculate maximum output size for single-\/call Block encoding. 

This is equivalent to \doxyref{lzma\-\_\-stream\-\_\-buffer\-\_\-bound()}{p.}{container_8h_a66d4366a47b8332bff2a512f44f5c45e} but for .xz Blocks. See the documentation of \doxyref{lzma\-\_\-stream\-\_\-buffer\-\_\-bound()}{p.}{container_8h_a66d4366a47b8332bff2a512f44f5c45e}. 

References H\-E\-A\-D\-E\-R\-S\-\_\-\-B\-O\-U\-N\-D, and L\-Z\-M\-A\-\_\-\-V\-L\-I\-\_\-\-C.



Referenced by lzma\-\_\-stream\-\_\-buffer\-\_\-bound().

\index{block.\-h@{block.\-h}!lzma\-\_\-block\-\_\-buffer\-\_\-encode@{lzma\-\_\-block\-\_\-buffer\-\_\-encode}}
\index{lzma\-\_\-block\-\_\-buffer\-\_\-encode@{lzma\-\_\-block\-\_\-buffer\-\_\-encode}!block.h@{block.\-h}}
\subsubsection[{lzma\-\_\-block\-\_\-buffer\-\_\-encode}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lzma\-\_\-ret} lzma\-\_\-block\-\_\-buffer\-\_\-encode (
\begin{DoxyParamCaption}
\item[{{\bf lzma\-\_\-block} $\ast$}]{block, }
\item[{{\bf lzma\-\_\-allocator} $\ast$}]{allocator, }
\item[{const uint8\-\_\-t $\ast$}]{in, }
\item[{size\-\_\-t}]{in\-\_\-size, }
\item[{uint8\-\_\-t $\ast$}]{out, }
\item[{size\-\_\-t $\ast$}]{out\-\_\-pos, }
\item[{size\-\_\-t}]{out\-\_\-size}
\end{DoxyParamCaption}
)}\label{block_8h_a41e080db33169819f985595d48a157bc}


Single-\/call .xz Block encoder. 

In contrast to the multi-\/call encoder initialized with \doxyref{lzma\-\_\-block\-\_\-encoder()}{p.}{block_8h_a2218a49025a0b44f9a6f9d6d24359359}, this function encodes also the Block Header. This is required to make it possible to write appropriate Block Header also in case the data isn't compressible, and different filter chain has to be used to encode the data in uncompressed form using uncompressed chunks of the L\-Z\-M\-A2 filter.

When the data isn't compressible, header\-\_\-size, compressed\-\_\-size, and uncompressed\-\_\-size are set just like when the data was compressible, but it is possible that header\-\_\-size is too small to hold the filter chain specified in block-\/$>$filters, because that isn't necessarily the filter chain that was actually used to encode the data. \doxyref{lzma\-\_\-block\-\_\-unpadded\-\_\-size()}{p.}{block_8h_a412d5605280fa29befae1b89e344bf30} still works normally, because it doesn't read the filters array.


\begin{DoxyParams}{Parameters}
{\em block} & Block options\-: block-\/$>$version, block-\/$>$check, and block-\/$>$filters must have been initialized. \\
\hline
{\em allocator} & \doxyref{lzma\-\_\-allocator}{p.}{structlzma__allocator} for custom allocator functions. Set to N\-U\-L\-L to use malloc() and free(). \\
\hline
{\em in} & Beginning of the input buffer \\
\hline
{\em in\-\_\-size} & Size of the input buffer \\
\hline
{\em out} & Beginning of the output buffer \\
\hline
{\em out\-\_\-pos} & The next byte will be written to out[$\ast$out\-\_\-pos]. $\ast$out\-\_\-pos is updated only if encoding succeeds. \\
\hline
{\em out\-\_\-size} & Size of the out buffer; the first byte into which no data is written to is out[out\-\_\-size].\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
-\/ L\-Z\-M\-A\-\_\-\-O\-K\-: Encoding was successful.
\begin{DoxyItemize}
\item L\-Z\-M\-A\-\_\-\-B\-U\-F\-\_\-\-E\-R\-R\-O\-R\-: Not enough output buffer space.
\item L\-Z\-M\-A\-\_\-\-U\-N\-S\-U\-P\-P\-O\-R\-T\-E\-D\-\_\-\-C\-H\-E\-C\-K
\item L\-Z\-M\-A\-\_\-\-O\-P\-T\-I\-O\-N\-S\-\_\-\-E\-R\-R\-O\-R
\item L\-Z\-M\-A\-\_\-\-M\-E\-M\-\_\-\-E\-R\-R\-O\-R
\item L\-Z\-M\-A\-\_\-\-D\-A\-T\-A\-\_\-\-E\-R\-R\-O\-R
\item L\-Z\-M\-A\-\_\-\-P\-R\-O\-G\-\_\-\-E\-R\-R\-O\-R 
\end{DoxyItemize}
\end{DoxyReturn}


References lzma\-\_\-check\-\_\-state\-::buffer, check, L\-Z\-M\-A\-\_\-\-B\-U\-F\-\_\-\-E\-R\-R\-O\-R, lzma\-\_\-check\-\_\-finish(), L\-Z\-M\-A\-\_\-\-C\-H\-E\-C\-K\-\_\-\-I\-D\-\_\-\-M\-A\-X, lzma\-\_\-check\-\_\-init(), lzma\-\_\-check\-\_\-is\-\_\-supported(), lzma\-\_\-check\-\_\-size(), lzma\-\_\-check\-\_\-update(), L\-Z\-M\-A\-\_\-\-O\-K, L\-Z\-M\-A\-\_\-\-O\-P\-T\-I\-O\-N\-S\-\_\-\-E\-R\-R\-O\-R, L\-Z\-M\-A\-\_\-\-P\-R\-O\-G\-\_\-\-E\-R\-R\-O\-R, L\-Z\-M\-A\-\_\-\-U\-N\-S\-U\-P\-P\-O\-R\-T\-E\-D\-\_\-\-C\-H\-E\-C\-K, and return\-\_\-if\-\_\-error.



Referenced by lzma\-\_\-stream\-\_\-buffer\-\_\-encode().

\index{block.\-h@{block.\-h}!lzma\-\_\-block\-\_\-buffer\-\_\-decode@{lzma\-\_\-block\-\_\-buffer\-\_\-decode}}
\index{lzma\-\_\-block\-\_\-buffer\-\_\-decode@{lzma\-\_\-block\-\_\-buffer\-\_\-decode}!block.h@{block.\-h}}
\subsubsection[{lzma\-\_\-block\-\_\-buffer\-\_\-decode}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lzma\-\_\-ret} lzma\-\_\-block\-\_\-buffer\-\_\-decode (
\begin{DoxyParamCaption}
\item[{{\bf lzma\-\_\-block} $\ast$}]{block, }
\item[{{\bf lzma\-\_\-allocator} $\ast$}]{allocator, }
\item[{const uint8\-\_\-t $\ast$}]{in, }
\item[{size\-\_\-t $\ast$}]{in\-\_\-pos, }
\item[{size\-\_\-t}]{in\-\_\-size, }
\item[{uint8\-\_\-t $\ast$}]{out, }
\item[{size\-\_\-t $\ast$}]{out\-\_\-pos, }
\item[{size\-\_\-t}]{out\-\_\-size}
\end{DoxyParamCaption}
)}\label{block_8h_a2bdf26b5fb43880364991a1536d74346}


Single-\/call .xz Block decoder. 

This is single-\/call equivalent of \doxyref{lzma\-\_\-block\-\_\-decoder()}{p.}{block_8h_aa92c73b2a228efe921fa2376aa7adc92}, and requires that the caller has already decoded Block Header and checked its memory usage.


\begin{DoxyParams}{Parameters}
{\em block} & Block options just like with \doxyref{lzma\-\_\-block\-\_\-decoder()}{p.}{block_8h_aa92c73b2a228efe921fa2376aa7adc92}. \\
\hline
{\em allocator} & \doxyref{lzma\-\_\-allocator}{p.}{structlzma__allocator} for custom allocator functions. Set to N\-U\-L\-L to use malloc() and free(). \\
\hline
{\em in} & Beginning of the input buffer \\
\hline
{\em in\-\_\-pos} & The next byte will be read from in[$\ast$in\-\_\-pos]. $\ast$in\-\_\-pos is updated only if decoding succeeds. \\
\hline
{\em in\-\_\-size} & Size of the input buffer; the first byte that won't be read is in[in\-\_\-size]. \\
\hline
{\em out} & Beginning of the output buffer \\
\hline
{\em out\-\_\-pos} & The next byte will be written to out[$\ast$out\-\_\-pos]. $\ast$out\-\_\-pos is updated only if encoding succeeds. \\
\hline
{\em out\-\_\-size} & Size of the out buffer; the first byte into which no data is written to is out[out\-\_\-size].\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
-\/ L\-Z\-M\-A\-\_\-\-O\-K\-: Decoding was successful.
\begin{DoxyItemize}
\item L\-Z\-M\-A\-\_\-\-O\-P\-T\-I\-O\-N\-S\-\_\-\-E\-R\-R\-O\-R
\item L\-Z\-M\-A\-\_\-\-D\-A\-T\-A\-\_\-\-E\-R\-R\-O\-R
\item L\-Z\-M\-A\-\_\-\-M\-E\-M\-\_\-\-E\-R\-R\-O\-R
\item L\-Z\-M\-A\-\_\-\-B\-U\-F\-\_\-\-E\-R\-R\-O\-R\-: Output buffer was too small.
\item L\-Z\-M\-A\-\_\-\-P\-R\-O\-G\-\_\-\-E\-R\-R\-O\-R 
\end{DoxyItemize}
\end{DoxyReturn}


References lzma\-\_\-next\-\_\-coder\-\_\-s\-::code, lzma\-\_\-next\-\_\-coder\-\_\-s\-::coder, L\-Z\-M\-A\-\_\-\-B\-U\-F\-\_\-\-E\-R\-R\-O\-R, L\-Z\-M\-A\-\_\-\-D\-A\-T\-A\-\_\-\-E\-R\-R\-O\-R, L\-Z\-M\-A\-\_\-\-F\-I\-N\-I\-S\-H, L\-Z\-M\-A\-\_\-\-N\-E\-X\-T\-\_\-\-C\-O\-D\-E\-R\-\_\-\-I\-N\-I\-T, L\-Z\-M\-A\-\_\-\-O\-K, L\-Z\-M\-A\-\_\-\-P\-R\-O\-G\-\_\-\-E\-R\-R\-O\-R, and L\-Z\-M\-A\-\_\-\-S\-T\-R\-E\-A\-M\-\_\-\-E\-N\-D.

