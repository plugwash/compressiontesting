<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>XZ Utils: xz/file_io.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">XZ Utils
   &#160;<span id="projectnumber">5.1.0alpha</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.1.2 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_53e01eec41348db90f08d9ee7e6793af.html">xz</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">file_io.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>File opening, unlinking, and closing.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="private_8h.html">private.h</a>&quot;</code><br/>
<code>#include &lt;fcntl.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="tuklib__open__stdxxx_8h.html">tuklib_open_stdxxx.h</a>&quot;</code><br/>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a36fa9b2e726512bc17a7a6d3e39002be"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a36fa9b2e726512bc17a7a6d3e39002be"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>O_BINARY</b>&#160;&#160;&#160;0</td></tr>
<tr class="memitem:a2e375ab32c7ef4581b026be28e4cc116"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a2e375ab32c7ef4581b026be28e4cc116"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>O_NOCTTY</b>&#160;&#160;&#160;0</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:aec1e9629ef5cc3abf4d2e39bd8006710"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aec1e9629ef5cc3abf4d2e39bd8006710"></a>
static bool&#160;</td><td class="memItemRight" valign="bottom"><b>io_write_buf</b> (<a class="el" href="structfile__pair.html">file_pair</a> *pair, const uint8_t *buf, size_t size)</td></tr>
<tr class="memitem:a43bba613ce0efd6af387cd04458ede8d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="file__io_8c.html#a43bba613ce0efd6af387cd04458ede8d">io_init</a> (void)</td></tr>
<tr class="memdesc:a43bba613ce0efd6af387cd04458ede8d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize the I/O module.  <a href="#a43bba613ce0efd6af387cd04458ede8d"></a><br/></td></tr>
<tr class="memitem:a26350b70a7ef7ae45e57f04157ade2aa"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="file__io_8c.html#a26350b70a7ef7ae45e57f04157ade2aa">io_no_sparse</a> (void)</td></tr>
<tr class="memdesc:a26350b70a7ef7ae45e57f04157ade2aa"><td class="mdescLeft">&#160;</td><td class="mdescRight">Disable creation of sparse files when decompressing.  <a href="#a26350b70a7ef7ae45e57f04157ade2aa"></a><br/></td></tr>
<tr class="memitem:a80290e05c048a6052bd8c35d7b69cfb6"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="file__io_8c.html#a80290e05c048a6052bd8c35d7b69cfb6">io_unlink</a> (const char *name, const struct stat *known_st)</td></tr>
<tr class="memdesc:a80290e05c048a6052bd8c35d7b69cfb6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Unlink a file.  <a href="#a80290e05c048a6052bd8c35d7b69cfb6"></a><br/></td></tr>
<tr class="memitem:a1884e01ba0a7757bb6fd96fa8a0bf09b"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="file__io_8c.html#a1884e01ba0a7757bb6fd96fa8a0bf09b">io_copy_attrs</a> (const <a class="el" href="structfile__pair.html">file_pair</a> *pair)</td></tr>
<tr class="memdesc:a1884e01ba0a7757bb6fd96fa8a0bf09b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Copies owner/group and permissions.  <a href="#a1884e01ba0a7757bb6fd96fa8a0bf09b"></a><br/></td></tr>
<tr class="memitem:af0470bc137d3ae386126db2ca94b5e65"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="file__io_8c.html#af0470bc137d3ae386126db2ca94b5e65">io_open_src_real</a> (<a class="el" href="structfile__pair.html">file_pair</a> *pair)</td></tr>
<tr class="memdesc:af0470bc137d3ae386126db2ca94b5e65"><td class="mdescLeft">&#160;</td><td class="mdescRight">Opens the source file. Returns false on success, true on error.  <a href="#af0470bc137d3ae386126db2ca94b5e65"></a><br/></td></tr>
<tr class="memitem:ac4fb03f340ee03676cbde913682a3719"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structfile__pair.html">file_pair</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="file__io_8c.html#ac4fb03f340ee03676cbde913682a3719">io_open_src</a> (const char *src_name)</td></tr>
<tr class="memdesc:ac4fb03f340ee03676cbde913682a3719"><td class="mdescLeft">&#160;</td><td class="mdescRight">Open the source file.  <a href="#ac4fb03f340ee03676cbde913682a3719"></a><br/></td></tr>
<tr class="memitem:ac4e485a5d6cbb717f7eddfc8eae35841"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="file__io_8c.html#ac4e485a5d6cbb717f7eddfc8eae35841">io_close_src</a> (<a class="el" href="structfile__pair.html">file_pair</a> *pair, bool success)</td></tr>
<tr class="memdesc:ac4e485a5d6cbb717f7eddfc8eae35841"><td class="mdescLeft">&#160;</td><td class="mdescRight">Closes source file of the <a class="el" href="structfile__pair.html">file_pair</a> structure.  <a href="#ac4e485a5d6cbb717f7eddfc8eae35841"></a><br/></td></tr>
<tr class="memitem:a0571f8f4694fe021d5d5a6b9859cba23"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a0571f8f4694fe021d5d5a6b9859cba23"></a>
static bool&#160;</td><td class="memItemRight" valign="bottom"><b>io_open_dest_real</b> (<a class="el" href="structfile__pair.html">file_pair</a> *pair)</td></tr>
<tr class="memitem:a51c7b0ad8b7829773a69972565b7d08d"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="file__io_8c.html#a51c7b0ad8b7829773a69972565b7d08d">io_open_dest</a> (<a class="el" href="structfile__pair.html">file_pair</a> *pair)</td></tr>
<tr class="memdesc:a51c7b0ad8b7829773a69972565b7d08d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Open the destination file.  <a href="#a51c7b0ad8b7829773a69972565b7d08d"></a><br/></td></tr>
<tr class="memitem:a2e1e4bee9c2f87daa8ec40b3072816a5"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="file__io_8c.html#a2e1e4bee9c2f87daa8ec40b3072816a5">io_close_dest</a> (<a class="el" href="structfile__pair.html">file_pair</a> *pair, bool success)</td></tr>
<tr class="memdesc:a2e1e4bee9c2f87daa8ec40b3072816a5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Closes destination file of the <a class="el" href="structfile__pair.html">file_pair</a> structure.  <a href="#a2e1e4bee9c2f87daa8ec40b3072816a5"></a><br/></td></tr>
<tr class="memitem:a8dcc56461111f392398385820ad9c1d9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="file__io_8c.html#a8dcc56461111f392398385820ad9c1d9">io_close</a> (<a class="el" href="structfile__pair.html">file_pair</a> *pair, bool success)</td></tr>
<tr class="memdesc:a8dcc56461111f392398385820ad9c1d9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Closes the file descriptors and frees possible allocated memory.  <a href="#a8dcc56461111f392398385820ad9c1d9"></a><br/></td></tr>
<tr class="memitem:aa06dd4cd771d5a19bc191ff334f0623a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="file__io_8c.html#aa06dd4cd771d5a19bc191ff334f0623a">io_fix_src_pos</a> (<a class="el" href="structfile__pair.html">file_pair</a> *pair, size_t rewind_size)</td></tr>
<tr class="memdesc:aa06dd4cd771d5a19bc191ff334f0623a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Fix the position in src_fd.  <a href="#aa06dd4cd771d5a19bc191ff334f0623a"></a><br/></td></tr>
<tr class="memitem:ae7642411c20e8800874f7f95489c8d9d"><td class="memItemLeft" align="right" valign="top">size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="file__io_8c.html#ae7642411c20e8800874f7f95489c8d9d">io_read</a> (<a class="el" href="structfile__pair.html">file_pair</a> *pair, <a class="el" href="unionio__buf.html">io_buf</a> *buf_union, size_t size)</td></tr>
<tr class="memdesc:ae7642411c20e8800874f7f95489c8d9d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reads from the source file to a buffer.  <a href="#ae7642411c20e8800874f7f95489c8d9d"></a><br/></td></tr>
<tr class="memitem:af0781545c818796c48a4ee8dadd2c2a7"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="file__io_8c.html#af0781545c818796c48a4ee8dadd2c2a7">io_pread</a> (<a class="el" href="structfile__pair.html">file_pair</a> *pair, <a class="el" href="unionio__buf.html">io_buf</a> *buf, size_t size, off_t pos)</td></tr>
<tr class="memdesc:af0781545c818796c48a4ee8dadd2c2a7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Read from source file from given offset to a buffer.  <a href="#af0781545c818796c48a4ee8dadd2c2a7"></a><br/></td></tr>
<tr class="memitem:a5d532508f4cfd5470b0b1eeb301ec27f"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a5d532508f4cfd5470b0b1eeb301ec27f"></a>
static bool&#160;</td><td class="memItemRight" valign="bottom"><b>is_sparse</b> (const <a class="el" href="unionio__buf.html">io_buf</a> *buf)</td></tr>
<tr class="memitem:a42ccfb816386ca04e622762bad58ef6f"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="file__io_8c.html#a42ccfb816386ca04e622762bad58ef6f">io_write</a> (<a class="el" href="structfile__pair.html">file_pair</a> *pair, const <a class="el" href="unionio__buf.html">io_buf</a> *buf, size_t size)</td></tr>
<tr class="memdesc:a42ccfb816386ca04e622762bad58ef6f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Writes a buffer to the destination file.  <a href="#a42ccfb816386ca04e622762bad58ef6f"></a><br/></td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a0b21eecca73d4dc0b8a24bb53f381ca8"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a0b21eecca73d4dc0b8a24bb53f381ca8"></a>
static bool&#160;</td><td class="memItemRight" valign="bottom"><b>warn_fchown</b></td></tr>
<tr class="memitem:a96b3b450da5d99ec1f6bd3e57d5f340a"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="file__io_8c.html#a96b3b450da5d99ec1f6bd3e57d5f340a">try_sparse</a> = true</td></tr>
<tr class="memdesc:a96b3b450da5d99ec1f6bd3e57d5f340a"><td class="mdescLeft">&#160;</td><td class="mdescRight">If true, try to create sparse files when decompressing.  <a href="#a96b3b450da5d99ec1f6bd3e57d5f340a"></a><br/></td></tr>
<tr class="memitem:aead170473661c2bec0f0a48adf5322b1"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="file__io_8c.html#aead170473661c2bec0f0a48adf5322b1">stdout_flags</a> = 0</td></tr>
</table>
<a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>File opening, unlinking, and closing. </p>
</div><h2>Function Documentation</h2>
<a class="anchor" id="a43bba613ce0efd6af387cd04458ede8d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void io_init </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize the I/O module. </p>

</div>
</div>
<a class="anchor" id="a26350b70a7ef7ae45e57f04157ade2aa"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void io_no_sparse </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Disable creation of sparse files when decompressing. </p>

<p>References <a class="el" href="file__io_8c.html#a96b3b450da5d99ec1f6bd3e57d5f340a">try_sparse</a>.</p>

</div>
</div>
<a class="anchor" id="a80290e05c048a6052bd8c35d7b69cfb6"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void io_unlink </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct stat *&#160;</td>
          <td class="paramname"><em>known_st</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Unlink a file. </p>
<p>This tries to verify that the file being unlinked really is the file that we want to unlink by verifying device and inode numbers. There's still a small unavoidable race, but this is much better than nothing (the file could have been moved/replaced even hours earlier). </p>

<p>References <a class="el" href="message_8h.html#a61c64c39e7ec889482a901fbd63f794c">message_error()</a>.</p>

<p>Referenced by <a class="el" href="file__io_8c.html#a2e1e4bee9c2f87daa8ec40b3072816a5">io_close_dest()</a>, and <a class="el" href="file__io_8c.html#ac4e485a5d6cbb717f7eddfc8eae35841">io_close_src()</a>.</p>

</div>
</div>
<a class="anchor" id="a1884e01ba0a7757bb6fd96fa8a0bf09b"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void io_copy_attrs </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structfile__pair.html">file_pair</a> *&#160;</td>
          <td class="paramname"><em>pair</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Copies owner/group and permissions. </p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000003">Todo:</a></b></dt><dd>ACL and EA support </dd></dl>

<p>References <a class="el" href="structfile__pair.html#a95b05b836e2abd7cb9b227f03dcb5492">file_pair::dest_fd</a>, <a class="el" href="structfile__pair.html#a7f1b46a8a665881ffa22d2d7b33b91ed">file_pair::dest_name</a>, <a class="el" href="message_8h.html#a7b1aa271362d38242ea6c42e3d5453aa">message_warning()</a>, and <a class="el" href="structfile__pair.html#ab2b63e4c15c0489b67ee3d795174d3dc">file_pair::src_st</a>.</p>

<p>Referenced by <a class="el" href="file__io_8h.html#a8dcc56461111f392398385820ad9c1d9">io_close()</a>.</p>

</div>
</div>
<a class="anchor" id="af0470bc137d3ae386126db2ca94b5e65"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool io_open_src_real </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structfile__pair.html">file_pair</a> *&#160;</td>
          <td class="paramname"><em>pair</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Opens the source file. Returns false on success, true on error. </p>

<p>References <a class="el" href="message_8h.html#a61c64c39e7ec889482a901fbd63f794c">message_error()</a>, <a class="el" href="message_8h.html#a7b1aa271362d38242ea6c42e3d5453aa">message_warning()</a>, <a class="el" href="signals_8c.html#a6c7cbcd4595590670a3784d393770693">signals_block()</a>, <a class="el" href="signals_8c.html#a55ea2250ff5153a3a4daf1f5a75ea921">signals_unblock()</a>, <a class="el" href="structfile__pair.html#acbab9ee46b39f49a7996360ae6dbe0a4">file_pair::src_fd</a>, <a class="el" href="structfile__pair.html#abcd6b5b852a5bc8815a44dd025113bcf">file_pair::src_name</a>, <a class="el" href="structfile__pair.html#ab2b63e4c15c0489b67ee3d795174d3dc">file_pair::src_st</a>, and <a class="el" href="signals_8c.html#a190aaf6ae9eaa75671718e1ceed999e6">user_abort</a>.</p>

<p>Referenced by <a class="el" href="file__io_8h.html#ac4fb03f340ee03676cbde913682a3719">io_open_src()</a>.</p>

</div>
</div>
<a class="anchor" id="ac4fb03f340ee03676cbde913682a3719"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structfile__pair.html">file_pair</a>* io_open_src </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>src_name</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Open the source file. </p>

<p>References <a class="el" href="file__io_8c.html#af0470bc137d3ae386126db2ca94b5e65">io_open_src_real()</a>, <a class="el" href="util_8c.html#a365345158771d9f70b1487c23149af53">is_empty_filename()</a>, <a class="el" href="signals_8c.html#a6c7cbcd4595590670a3784d393770693">signals_block()</a>, <a class="el" href="signals_8c.html#a55ea2250ff5153a3a4daf1f5a75ea921">signals_unblock()</a>, and <a class="el" href="structfile__pair.html#abcd6b5b852a5bc8815a44dd025113bcf">file_pair::src_name</a>.</p>

<p>Referenced by <a class="el" href="coder_8h.html#acbe7065d22ed54ab19a1a9bb0cb808de">coder_run()</a>, and <a class="el" href="list_8h.html#a2b9bdcc3cdcc48e99a29e178df9d4899">list_file()</a>.</p>

</div>
</div>
<a class="anchor" id="ac4e485a5d6cbb717f7eddfc8eae35841"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void io_close_src </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structfile__pair.html">file_pair</a> *&#160;</td>
          <td class="paramname"><em>pair</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>success</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Closes source file of the <a class="el" href="structfile__pair.html">file_pair</a> structure. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pair</td><td>File whose src_fd should be closed </td></tr>
    <tr><td class="paramname">success</td><td>If true, the file will be removed from the disk if closing succeeds and &ndash;keep hasn't been used. </td></tr>
  </table>
  </dd>
</dl>

<p>References <a class="el" href="file__io_8c.html#a80290e05c048a6052bd8c35d7b69cfb6">io_unlink()</a>, <a class="el" href="structfile__pair.html#acbab9ee46b39f49a7996360ae6dbe0a4">file_pair::src_fd</a>, <a class="el" href="structfile__pair.html#abcd6b5b852a5bc8815a44dd025113bcf">file_pair::src_name</a>, and <a class="el" href="structfile__pair.html#ab2b63e4c15c0489b67ee3d795174d3dc">file_pair::src_st</a>.</p>

<p>Referenced by <a class="el" href="file__io_8h.html#a8dcc56461111f392398385820ad9c1d9">io_close()</a>.</p>

</div>
</div>
<a class="anchor" id="a51c7b0ad8b7829773a69972565b7d08d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool io_open_dest </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structfile__pair.html">file_pair</a> *&#160;</td>
          <td class="paramname"><em>pair</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Open the destination file. </p>

<p>References <a class="el" href="signals_8c.html#a6c7cbcd4595590670a3784d393770693">signals_block()</a>, and <a class="el" href="signals_8c.html#a55ea2250ff5153a3a4daf1f5a75ea921">signals_unblock()</a>.</p>

<p>Referenced by <a class="el" href="coder_8h.html#acbe7065d22ed54ab19a1a9bb0cb808de">coder_run()</a>.</p>

</div>
</div>
<a class="anchor" id="a2e1e4bee9c2f87daa8ec40b3072816a5"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool io_close_dest </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structfile__pair.html">file_pair</a> *&#160;</td>
          <td class="paramname"><em>pair</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>success</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Closes destination file of the <a class="el" href="structfile__pair.html">file_pair</a> structure. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pair</td><td>File whose dest_fd should be closed </td></tr>
    <tr><td class="paramname">success</td><td>If false, the file will be removed from the disk.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Zero if closing succeeds. On error, -1 is returned and error message printed. </dd></dl>

<p>References <a class="el" href="structfile__pair.html#a95b05b836e2abd7cb9b227f03dcb5492">file_pair::dest_fd</a>, <a class="el" href="structfile__pair.html#a7f1b46a8a665881ffa22d2d7b33b91ed">file_pair::dest_name</a>, <a class="el" href="structfile__pair.html#a31c3f2a5ea5d9538c4e29398c535a183">file_pair::dest_st</a>, <a class="el" href="file__io_8c.html#a80290e05c048a6052bd8c35d7b69cfb6">io_unlink()</a>, <a class="el" href="message_8h.html#a61c64c39e7ec889482a901fbd63f794c">message_error()</a>, and <a class="el" href="file__io_8c.html#aead170473661c2bec0f0a48adf5322b1">stdout_flags</a>.</p>

<p>Referenced by <a class="el" href="file__io_8h.html#a8dcc56461111f392398385820ad9c1d9">io_close()</a>.</p>

</div>
</div>
<a class="anchor" id="a8dcc56461111f392398385820ad9c1d9"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void io_close </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structfile__pair.html">file_pair</a> *&#160;</td>
          <td class="paramname"><em>pair</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>success</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Closes the file descriptors and frees possible allocated memory. </p>
<p>The success argument determines if source or destination file gets unlinked:</p>
<ul>
<li>false: The destination file is unlinked.</li>
<li>true: The source file is unlinked unless writing to stdout or &ndash;keep was used. </li>
</ul>

<p>References <a class="el" href="structfile__pair.html#a95b05b836e2abd7cb9b227f03dcb5492">file_pair::dest_fd</a>, <a class="el" href="structfile__pair.html#a7f1b46a8a665881ffa22d2d7b33b91ed">file_pair::dest_name</a>, <a class="el" href="structfile__pair.html#a8372ad2043ad566b72c2743bd42bbe22">file_pair::dest_pending_sparse</a>, <a class="el" href="structfile__pair.html#a0267a1a379d041c2c4dbf6db1035a20c">file_pair::dest_try_sparse</a>, <a class="el" href="file__io_8c.html#a2e1e4bee9c2f87daa8ec40b3072816a5">io_close_dest()</a>, <a class="el" href="file__io_8c.html#ac4e485a5d6cbb717f7eddfc8eae35841">io_close_src()</a>, <a class="el" href="file__io_8c.html#a1884e01ba0a7757bb6fd96fa8a0bf09b">io_copy_attrs()</a>, <a class="el" href="message_8h.html#a61c64c39e7ec889482a901fbd63f794c">message_error()</a>, <a class="el" href="signals_8c.html#a6c7cbcd4595590670a3784d393770693">signals_block()</a>, and <a class="el" href="signals_8c.html#a55ea2250ff5153a3a4daf1f5a75ea921">signals_unblock()</a>.</p>

<p>Referenced by <a class="el" href="coder_8h.html#acbe7065d22ed54ab19a1a9bb0cb808de">coder_run()</a>, and <a class="el" href="list_8h.html#a2b9bdcc3cdcc48e99a29e178df9d4899">list_file()</a>.</p>

</div>
</div>
<a class="anchor" id="aa06dd4cd771d5a19bc191ff334f0623a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void io_fix_src_pos </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structfile__pair.html">file_pair</a> *&#160;</td>
          <td class="paramname"><em>pair</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>rewind_size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Fix the position in src_fd. </p>
<p>This is used when &ndash;single-thream has been specified and decompression is successful. If the input file descriptor supports seeking, this function fixes the input position to point to the next byte after the decompressed stream.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pair</td><td>File pair having the source file open for reading </td></tr>
    <tr><td class="paramname">rewind_size</td><td>How many bytes of extra have been read i.e. how much to seek backwards. </td></tr>
  </table>
  </dd>
</dl>

<p>References <a class="el" href="structfile__pair.html#acbab9ee46b39f49a7996360ae6dbe0a4">file_pair::src_fd</a>.</p>

<p>Referenced by <a class="el" href="coder_8c.html#a1dc9a6813d9158c93ad48053549825b0">coder_normal()</a>.</p>

</div>
</div>
<a class="anchor" id="ae7642411c20e8800874f7f95489c8d9d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">size_t io_read </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structfile__pair.html">file_pair</a> *&#160;</td>
          <td class="paramname"><em>pair</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="unionio__buf.html">io_buf</a> *&#160;</td>
          <td class="paramname"><em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Reads from the source file to a buffer. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pair</td><td>File pair having the source file open for reading </td></tr>
    <tr><td class="paramname">buf</td><td>Destination buffer to hold the read data </td></tr>
    <tr><td class="paramname">size</td><td>Size of the buffer; assumed be smaller than SSIZE_MAX</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>On success, number of bytes read is returned. On end of file zero is returned and pair-&gt;src_eof set to true. On error, SIZE_MAX is returned and error message printed. </dd></dl>

<p>References <a class="el" href="message_8h.html#a61c64c39e7ec889482a901fbd63f794c">message_error()</a>, <a class="el" href="structfile__pair.html#afee08cdab4c8f19e0734a6da48e21921">file_pair::src_eof</a>, <a class="el" href="structfile__pair.html#acbab9ee46b39f49a7996360ae6dbe0a4">file_pair::src_fd</a>, <a class="el" href="structfile__pair.html#abcd6b5b852a5bc8815a44dd025113bcf">file_pair::src_name</a>, and <a class="el" href="signals_8c.html#a190aaf6ae9eaa75671718e1ceed999e6">user_abort</a>.</p>

<p>Referenced by <a class="el" href="coder_8c.html#a1dc9a6813d9158c93ad48053549825b0">coder_normal()</a>, <a class="el" href="coder_8c.html#ae31acd560ee4d35b7bd0d1bdc94fde0a">coder_passthru()</a>, <a class="el" href="coder_8h.html#acbe7065d22ed54ab19a1a9bb0cb808de">coder_run()</a>, and <a class="el" href="file__io_8h.html#af0781545c818796c48a4ee8dadd2c2a7">io_pread()</a>.</p>

</div>
</div>
<a class="anchor" id="af0781545c818796c48a4ee8dadd2c2a7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool io_pread </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structfile__pair.html">file_pair</a> *&#160;</td>
          <td class="paramname"><em>pair</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="unionio__buf.html">io_buf</a> *&#160;</td>
          <td class="paramname"><em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">off_t&#160;</td>
          <td class="paramname"><em>pos</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Read from source file from given offset to a buffer. </p>
<p>This is remotely similar to standard pread(). This uses lseek() though, so the read offset is changed on each call.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pair</td><td>Seekable source file </td></tr>
    <tr><td class="paramname">buf</td><td>Destination buffer </td></tr>
    <tr><td class="paramname">size</td><td>Amount of data to read </td></tr>
    <tr><td class="paramname">pos</td><td>Offset relative to the beginning of the file, from which the data should be read.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>On success, false is returned. On error, error message is printed and true is returned. </dd></dl>

<p>References <a class="el" href="file__io_8c.html#ae7642411c20e8800874f7f95489c8d9d">io_read()</a>, <a class="el" href="message_8h.html#a61c64c39e7ec889482a901fbd63f794c">message_error()</a>, <a class="el" href="structfile__pair.html#acbab9ee46b39f49a7996360ae6dbe0a4">file_pair::src_fd</a>, and <a class="el" href="structfile__pair.html#abcd6b5b852a5bc8815a44dd025113bcf">file_pair::src_name</a>.</p>

<p>Referenced by <a class="el" href="list_8c.html#ae8bf55be793e1ad58bc179ac19168c90">parse_block_header()</a>, <a class="el" href="list_8c.html#a9e7a2155d21e8e64be85e248e8a77f62">parse_check_value()</a>, and <a class="el" href="list_8c.html#ada243f83a8540051b161d0a114ef8f24">parse_indexes()</a>.</p>

</div>
</div>
<a class="anchor" id="a42ccfb816386ca04e622762bad58ef6f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool io_write </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structfile__pair.html">file_pair</a> *&#160;</td>
          <td class="paramname"><em>pair</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="unionio__buf.html">io_buf</a> *&#160;</td>
          <td class="paramname"><em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Writes a buffer to the destination file. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pair</td><td>File pair having the destination file open for writing </td></tr>
    <tr><td class="paramname">buf</td><td>Buffer containing the data to be written </td></tr>
    <tr><td class="paramname">size</td><td>Size of the buffer; assumed be smaller than SSIZE_MAX</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>On success, zero is returned. On error, -1 is returned and error message printed. </dd></dl>

<p>References <a class="el" href="structfile__pair.html#a95b05b836e2abd7cb9b227f03dcb5492">file_pair::dest_fd</a>, <a class="el" href="structfile__pair.html#a7f1b46a8a665881ffa22d2d7b33b91ed">file_pair::dest_name</a>, <a class="el" href="structfile__pair.html#a8372ad2043ad566b72c2743bd42bbe22">file_pair::dest_pending_sparse</a>, <a class="el" href="structfile__pair.html#a0267a1a379d041c2c4dbf6db1035a20c">file_pair::dest_try_sparse</a>, and <a class="el" href="message_8h.html#a61c64c39e7ec889482a901fbd63f794c">message_error()</a>.</p>

<p>Referenced by <a class="el" href="coder_8c.html#a1dc9a6813d9158c93ad48053549825b0">coder_normal()</a>, and <a class="el" href="coder_8c.html#ae31acd560ee4d35b7bd0d1bdc94fde0a">coder_passthru()</a>.</p>

</div>
</div>
<h2>Variable Documentation</h2>
<a class="anchor" id="a96b3b450da5d99ec1f6bd3e57d5f340a"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool try_sparse = true</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>If true, try to create sparse files when decompressing. </p>

<p>Referenced by <a class="el" href="file__io_8h.html#a26350b70a7ef7ae45e57f04157ade2aa">io_no_sparse()</a>.</p>

</div>
</div>
<a class="anchor" id="aead170473661c2bec0f0a48adf5322b1"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int stdout_flags = 0</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>File status flags of standard output. This is used by <a class="el" href="file__io_8c.html#a51c7b0ad8b7829773a69972565b7d08d" title="Open the destination file.">io_open_dest()</a> and <a class="el" href="file__io_8c.html#a2e1e4bee9c2f87daa8ec40b3072816a5" title="Closes destination file of the file_pair structure.">io_close_dest()</a>. </p>

<p>Referenced by <a class="el" href="file__io_8c.html#a2e1e4bee9c2f87daa8ec40b3072816a5">io_close_dest()</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Jun 5 2014 14:45:51 for XZ Utils by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.1.2
</small></address>
</body>
</html>
